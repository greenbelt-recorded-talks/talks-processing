{% extends 'base.html' %}

{% block content %}

<h1 class="uk-heading-line uk-text-center"><span>Talks</span></h1>

<div uk-filter="target: .js-filter">

    <div class="uk-grid-small uk-grid-divider uk-child-width-auto" uk-grid>
        <div>
            <ul class="uk-subnav uk-subnav-pill" uk-margin>
                <li class="uk-active" uk-filter-control><a href="#">All</a></li>
            </ul>
        </div>
        <div>
            <ul class="uk-subnav uk-subnav-pill" uk-margin>
		<li>RAW</li>
                <li uk-filter-control="filter: [data-has-raw='false']; group: raw"><a href="#">No</a></li>
		<li uk-filter-control="filter: [data-has-raw='true']; group: raw"><a href="#">Yes</a></li>
	    </ul>
	</div>
	<div>
            <ul class="uk-subnav uk-subnav-pill" uk-margin>
                <li>Edited</li>
                <li uk-filter-control="filter: [data-has-edited='false']; group: edited"><a href="#">No</a></li>
                <li uk-filter-control="filter: [data-has-edited='true']; group: edited"><a href="#">Yes</a></li>
            </ul>
        </div>
	<div>
            <ul class="uk-subnav uk-subnav-pill" uk-margin>
		<li>Processed</li>
                <li uk-filter-control="filter: [data-has-processed='false']; group: processed"><a href="#">No</a></li>
                <li uk-filter-control="filter: [data-has-processed='true']; group: processed"><a href="#">Yes</a></li>
            </ul>
        </div>
	<div>
            <ul class="uk-subnav uk-subnav-pill" uk-margin>
                <li>Priority</li>
                <li uk-filter-control="filter: [data-priority='false']; group: priority"><a href="#">Additional</a></li>
                <li uk-filter-control="filter: [data-priority='true']; group: priority"><a href="#">Priority</a></li>
            </ul>
        </div>
	<div>
            <ul class="uk-subnav uk-subnav-pill" uk-margin>
                <li>Status</li>
                <li uk-filter-control="filter: [data-cancelled='false']; group: cancelled"><a href="#">Active</a></li>
                <li uk-filter-control="filter: [data-cancelled='true']; group: cancelled"><a href="#">Cancelled</a></li>
            </ul>
        </div>
	<div>
            <ul class="uk-subnav uk-subnav-pill" uk-margin>
                <li>Cleared</li>
                <li uk-filter-control="filter: [data-cleared='false']; group: cleared"><a href="#">No</a></li>
                <li uk-filter-control="filter: [data-cleared='true']; group: cleared"><a href="#">Yes</a></li>
            </ul>
        </div>
    </div>

<ul class="js-filter" uk-grid>

{% for talk in talks %}

{% set has_raw = "true" if 'gb' + gb_year + '-' + ('%03d' % talk.id)|string+ "_RAW.mp3" in raw_files else "false" %}
{% set has_edited = "true" if 'gb' + gb_year + '-' + ('%03d' % talk.id)|string+"_EDITED.mp3" in edited_files else "false" %}
{% set has_processed = "true" if ('%03d' % talk.id)|string in processed_files else "false" %}
{% set has_notes = "true" if 'gb' + gb_year + '-' + ('%03d' % talk.id)|string + "recorder_notes.jpg" in notes_files else "false" %}
{% set is_priority = "true" if talk["is_priority"] else "false" %} 
{% set is_cancelled = "true" if talk.is_cancelled else "false" %}
{% set is_cleared = "true" if talk.is_cleared else "false" %}

<li class="uk-card uk-card-body uk-card-default{% if talk.is_cancelled %} uk-card-muted{% endif %}" data-has-raw="{{ has_raw }}" data-has-edited="{{ has_edited }}" data-has-processed="{{ has_processed }}" data-priority="{{ is_priority }}" data-cancelled="{{ is_cancelled }}" data-cleared="{{ is_cleared }}" >
	<div class="uk-width-1-1">
		<h3 class="uk-card-title" id="talk_{{ talk.id }}">{{ 'gb' + gb_year + '-' + ('%03d' % talk.id) }}: {{ talk.title }}</h3>
		<div class="uk-container uk-text-default uk-text-bold">{{ talk.day }} {{ talk.start_time.strftime("%H:%M") }} - {{ talk.end_time.strftime("%H:%M") }} | {% if talk.is_cancelled %}<span style="color: red;">CANCELLED</span> {% endif %}{% if not talk.is_cleared %}NOT CLEARED FOR RELEASE {% endif %}{% if talk.has_explicit_warning_sticker %}Explicit {% endif %}{% if talk.has_distressing_content_warning_sticker %}Advisory {% endif %}{% if talk.has_technical_issues_sticker %}Technical {% endif %}{% if talk.has_copyright_removal_sticker %}Copyright {% endif %} </div>
		<br />
		<div class="uk-container"><span class="uk-text-default uk-text-bold">{{ talk.speaker }}:</span>
		<span class="uk-text-default">{{ talk.description }}</span></div>
		<hr />

		<div class="uk-child-width-expand@s uk-text-center" uk-grid>

    			<div>
        			<div class="uk-card uk-card-default uk-card-body">
				<span>RAW</span>
					{% if has_raw == "true"  %}
                                	<p><audio controls src="{{ url_for("getfile", file_type="raw", talk_id=talk.id) }}"></audio></p>
        				<p><a href="{{ url_for("getfile", file_type="raw", talk_id=talk.id) }}">Download</a></p>
					{% endif %}
				<hr class="uk-divider-icon"/>
				Replace file:
				<form method=post enctype=multipart/form-data name=upload_talk action=uploadtalk>
                			<input name=file type=file id=file accept=".mp3">
                			<input name=file_type type=hidden value="raw">
                			<input name=talk_id type=hidden value="{{talk.id}}">
                			<button>Upload</button>
        			</form>
				<hr class="uk-divider-icon"/>
				</div>
    			</div>
    			<div>
        			<div class="uk-card uk-card-default uk-card-body">
				<span>Edited</span>
				{% if has_edited == "true" %}
				<p><audio controls src="{{ url_for("getfile", file_type="edited", talk_id=talk.id) }}"></audio></p>
        			<p><a href="{{ url_for("getfile", file_type="edited", talk_id=talk.id) }}">Download</a></p>
        			{% endif %}
				<hr class="uk-divider-icon"/>
				Replace file:
       				<form method=post enctype=multipart/form-data name=upload_edited_talk action=uploadtalk>
                			<input name=file type=file id=file accept=".mp3">
                			<input name=file_type type=hidden value="edited">
                			<input name=talk_id type=hidden value="{{talk.id}}">
                			<button>Upload</button>
        			</form>
				<hr class="uk-divider-icon"/>

				</div>
    			</div>
		</div>
		<div class="uk-child-width-expand@s uk-text-center" uk-grid>
    			<div>
        			<div class="uk-card uk-card-default uk-card-body">
				<span>Processed</span>
				{% if has_processed == "true" %}
                                <p><audio controls src="{{ url_for("getfile", file_type="processed", talk_id=talk.id) }}"></audio></p>
        			<p><a href="{{ url_for("getfile", file_type="processed", talk_id=talk.id) }}">Download</a></p>
				<hr class="uk-divider-icon"/>
				<form action=deletetalk method=post onSubmit="return confirm('Are you sure you want to delete the processed file for talk {{ talk.id }}?')">
					<input name=file_type type=hidden value="processed">
					<input name=talk_id type=hidden value="{{talk.id}}">
					<button style="color:red">Delete Processed File</button>
				</form>
				{% endif %}

				</div>
    			</div>
                	<div>
                        	<div class="uk-card uk-card-default uk-card-body">
                                <span>Recorders Notes</span>
                                {% if has_notes == "true" %}
				<p><img src="{{ url_for("getfile", file_type="recorder_notes", talk_id=talk.id) }}" style="width:50px;height:100px;" ></p>
                                <p><a href="{{ url_for("getfile", file_type="recorder_notes", talk_id=talk.id) }}">Download</a></p>
                                {% endif %}
                        	</div>
                	</div>
		</div>
		<hr />

		<div class="uk-container">
			<span class="uk-text-default uk-text-bold">Assigned Recorder:</span>
			<form action="{{ url_for('assign_recorder') }}" method="post" style="display: inline-block; margin-left: 10px;">
				<input type="hidden" name="talk_id" value="{{ talk.id }}">
				<select class="uk-select" name="recorder_name" style="width: 200px; display: inline-block;">
					<option value="">None</option>
					{% for recorder in recorders %}
						<option value="{{ recorder.name }}" {% if talk.recorder_name == recorder.name %}selected{% endif %}>
							{{ recorder.name }}
						</option>
					{% endfor %}
				</select>
				<button type="submit" class="uk-button uk-button-primary uk-button-small" style="margin-left: 5px;">Assign</button>
			</form>
		</div>
		<hr />

		<span class="uk-text-default uk-text-bold"> <a href="{{ url_for("edit_talk", talk_id=talk.id) }}">Edit</a> | 
		{% if talk.is_cancelled %}
			<form action="{{ url_for('toggle_talk_cancelled') }}" method="post" style="display: inline;">
				<input type="hidden" name="talk_id" value="{{ talk.id }}">
				<input type="hidden" name="action" value="uncancel">
				<button type="submit" class="uk-button uk-button-link uk-text-success" onclick="return confirm('Are you sure you want to restore talk {{ talk.id }}?')">Restore</button>
			</form>
		{% else %}
			<form action="{{ url_for('toggle_talk_cancelled') }}" method="post" style="display: inline;">
				<input type="hidden" name="talk_id" value="{{ talk.id }}">
				<input type="hidden" name="action" value="cancel">
				<button type="submit" class="uk-button uk-button-link uk-text-danger" onclick="return confirm('Are you sure you want to cancel talk {{ talk.id }}? This will mark it as cancelled but preserve the talk ID.')">Cancel</button>
			</form>
		{% endif %}
		</span>

</div>
</li>

{% endfor %}

</ul>

</div>
</div>

{% endblock %}


